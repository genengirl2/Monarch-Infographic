<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Save the Monarchs Infographic</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F7F7F7;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 450px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 350px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
                max-height: 400px;
            }
        }
        .flow-arrow {
            content: '';
            position: absolute;
            width: 2px;
            background-color: #FF6B6B;
            z-index: 0;
        }
        .flow-arrow-right::after {
            content: '‚ñ∂';
            position: absolute;
            right: -8px;
            top: 50%;
            transform: translateY(-50%);
            color: #FF6B6B;
            font-size: 1rem;
        }
        .flow-arrow-down::after {
            content: '‚ñº';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            color: #FF6B6B;
            font-size: 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #5B5F97;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-[#F7F7F7] text-[#3D3D3D]">

    <div class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-6xl font-black text-[#5B5F97] mb-2">SAVE THE MONARCH</h1>
            <p class="text-lg md:text-xl text-gray-600">A species in peril and how you can be the hero they need.</p>
        </header>

        <div class="mb-12 rounded-lg overflow-hidden shadow-lg">
            <img src="https://wildlife.org/wp-content/uploads/2017/01/monarch.png" alt="Monarch Butterfly" class="w-full h-auto object-cover">
        </div>

        <main class="grid grid-cols-1 lg:grid-cols-2 gap-8 md:gap-12">

            <div class="lg:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8 flex flex-col md:flex-row items-center gap-8">
                <div class="text-center md:text-left flex-1">
                    <h2 class="text-2xl font-bold text-[#5B5F97] mb-3">A Drastic Decline</h2>
                    <p class="text-gray-700 mb-4">Over the past two decades, the monarch butterfly population has plummeted. This iconic species, known for its incredible 3-000-mile migration, is facing unprecedented threats that have pushed it to the brink.</p>
                    <div class="text-7xl md:text-8xl font-black text-[#FFC700]">
                        90%
                    </div>
                    <p class="text-lg font-bold text-gray-800">Population Lost</p>
                    <div class="mt-8 text-center">
                        <button id="generateFactBtn" class="bg-[#5B5F97] text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-[#FF6B6B] transition duration-300 ease-in-out">
                            Get a ‚ú® Monarch Fact ‚ú®
                        </button>
                        <div id="factOutput" class="mt-4 p-3 bg-gray-100 rounded-lg text-gray-800 italic">
                            Click for an amazing fact!
                        </div>
                        <div id="factLoadingIndicator" class="hidden flex justify-center items-center mt-2">
                            <div class="spinner mr-2"></div>
                            Generating fact...
                        </div>
                    </div>
                </div>
                <div class="flex-1 w-full max-w-sm">
                    <div class="chart-container">
                        <canvas id="populationDeclineChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#5B5F97] mb-4 text-center">Threats to Survival</h2>
                <p class="text-gray-700 mb-6 text-center">Multiple factors contribute to the monarch's decline, primarily driven by human activity. The loss of their essential habitat is the most significant challenge they face.</p>
                <div class="chart-container h-80 md:h-96 max-h-[450px]">
                    <canvas id="threatsChart"></canvas>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#5B5F97] mb-6 text-center">The Monarch Life Cycle</h2>
                <p class="text-gray-700 mb-8 text-center">The monarch undergoes a complete metamorphosis, a remarkable transformation that is entirely dependent on a single plant: <span style="font-weight: bold; color: #FFC700;">milkweed.</span></p>
                <img src="https://outdoornebraska.gov/wp-content/uploads/2023/03/monarch_male_female.png" alt="Adult Monarch Butterfly" class="w-full max-w-md mx-auto mb-8 rounded-lg shadow-md">
                <div class="relative flex flex-col items-center space-y-8">
                    <div class="relative z-10 w-full p-4 bg-[#FFC700] bg-opacity-20 rounded-lg border-l-4 border-[#FFC700]">
                        <p class="font-bold text-lg">1. Egg ü•ö</p>
                        <p>Females lay tiny, off-white eggs exclusively on milkweed leaves.</p>
                    </div>
                    <div class="flow-arrow h-8 top-full left-1/2 -translate-x-1/2 -mt-8"></div>
                    <div class="relative z-10 w-full p-4 bg-[#FF6B6B] bg-opacity-20 rounded-lg border-l-4 border-[#FF6B6B]">
                        <p class="font-bold text-lg">2. Larva (Caterpillar) üêõ</p>
                        <p>The caterpillar hatches and eats only milkweed, growing rapidly.</p>
                    </div>
                    <div class="flow-arrow h-8 top-full left-1/2 -translate-x-1/2 -mt-8"></div>
                    <div class="relative z-10 w-full p-4 bg-[#5B5F97] bg-opacity-20 rounded-lg border-l-4 border-[#5B5F97]">
                        <p class="font-bold text-lg">3. Pupa (Chrysalis) ‚ú®</p>
                        <p>It forms a beautiful green chrysalis, where the transformation occurs.</p>
                    </div>
                     <div class="flow-arrow h-8 top-full left-1/2 -translate-x-1/2 -mt-8"></div>
                    <div class="relative z-10 w-full p-4 bg-green-500 bg-opacity-20 rounded-lg border-l-4 border-green-500">
                        <p class="font-bold text-lg">4. Adult Butterfly ü¶ã</p>
                        <p>The butterfly emerges, ready to feed on nectar and continue the cycle.</p>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 bg-[#5B5F97] text-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-3xl font-black text-center mb-2 text-[#FFC700]">The Milkweed Connection</h2>
                <p class="text-center text-lg max-w-3xl mx-auto">Milkweed is the nursery, shelter and its only food source; monarch caterpillars depend on 100% on milkweed. No milkweed means no monarchs. <span style="color: #FF6B6B; font-weight: bold;">Planting NATIVE milkweed</span> is the single most important action we can take to help save this species. Since we are in California, the <span class="font-bold text-[#FF6B6B] text-xl">SHOWY milkweed</span> is ideal and the second would be the <span class="font-bold text-[#FF6B6B] text-xl">BROADLEAF milkweed</span>. </p>
            </div>

            <div class="lg:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#FF6B6B] mb-4 text-center">The Dangers of Non-Native Milkweed</h2>
                <p class="text-gray-700 mb-8 text-center">While any milkweed might seem helpful, non-native varieties, particularly <span class="font-bold">tropical milkweed</span> (Asclepias curassavica) picture shown below, can actually <strong>harm monarchs</strong>. Unlike native milkweeds that die back in winter, tropical milkweed often persists, disrupting the monarch's natural migratory cues. This can lead to monarchs staying in areas too cold for them or encouraging continuous breeding, which facilitates the spread of a debilitating parasite called *Ophryocystis elektroscirrha* (OE).</p>
                <img src="https://static.wixstatic.com/media/0f6b2e_b46e4711a77247bc976715271cfbbdbc~mv2.jpg/v1/fill/w_768,h_768,al_c,q_85,enc_avif,quality_auto/0f6b2e_b46e4711a77247bc976715271cfbbdbc~mv2.jpg" alt="Tropical Milkweed Warning" class="w-full max-w-xl mx-auto mb-8 rounded-lg shadow-md">
                <p class="text-center text-xl font-bold text-[#FF6B6B]">Always choose milkweed species native to your region to ensure the best support for monarch health and migration.</p>
            </div>

            <div class="lg:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8">
                <h2 class="text-2xl font-bold text-[#5B5F97] mb-4 text-center">How to Grow Milkweed</h2>
                <p class="text-gray-700 mb-8 text-center">You can create a monarch sanctuary in your own garden, balcony, or community space. Follow these steps to cultivate the milkweed that monarchs need.</p>
                <img src="https://cdn.shopify.com/s/files/1/1740/1449/files/MilkWeed_Header.jpg?v=1638393863" alt="Monarch Butterfly on Milkweed Plant" class="w-full max-w-xl mx-auto mb-8 rounded-lg shadow-md">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <div class="relative flex flex-col items-center">
                        <div class="bg-gray-100 p-6 rounded-lg shadow-inner h-full">
                            <div class="text-5xl mb-4">1Ô∏è‚É£</div>
                            <h3 class="text-xl font-bold text-[#FF6B6B] mb-2">Stratify Your Seeds</h3>
                            <p class="text-gray-600">Most milkweed seeds need a cold period. You can do this naturally by planting in the fall, or artificially by refrigerating seeds in a damp paper towel for 3-6 weeks.</p>
                        </div>
                        <div class="hidden md:block flow-arrow w-8 left-full top-1/2 -translate-y-1/2 -ml-4 flow-arrow-right"></div>
                         <div class="md:hidden flow-arrow h-8 top-full left-1/2 -translate-x-1/2 -mt-4 flow-arrow-down"></div>
                    </div>
                    <div class="relative flex flex-col items-center">
                        <div class="bg-gray-100 p-6 rounded-lg shadow-inner h-full">
                            <div class="text-5xl mb-4">2Ô∏è‚É£</div>
                            <h3 class="text-xl font-bold text-[#FFC700] mb-2">Plant with Care</h3>
                            <p class="text-gray-600">Sow seeds in a sunny spot after the last frost. You can start them indoors 4-8 weeks early for a head start. Ensure your soil is well-draining.</p>
                        </div>
                         <div class="hidden md:block flow-arrow w-8 left-full top-1/2 -translate-y-1/2 -ml-4 flow-arrow-right"></div>
                         <div class="md:hidden flow-arrow h-8 top-full left-1/2 -translate-x-1/2 -mt-4 flow-arrow-down"></div>
                    </div>
                    <div class="relative flex flex-col items-center">
                        <div class="bg-gray-100 p-6 rounded-lg shadow-inner h-full">
                            <div class="text-5xl mb-4">3Ô∏è‚É£</div>
                            <h3 class="text-xl font-bold text-[#5B5F97] mb-2">Nurture & Watch</h3>
                            <p class="text-gray-600">Keep the soil moist while seedlings are young. Avoid all pesticides. Soon, you'll provide a vital food source and witness the magic of the monarch life cycle firsthand!</p>
                        </div>
                    </div>
                </div>
                <div class="mt-10 text-center">
                    <button id="generateTipBtn" class="bg-[#FF6B6B] text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-[#FFC700] transition duration-300 ease-in-out">
                        Get a ‚ú® Milkweed Planting Tip ‚ú®
                    </button>
                    <div id="tipOutput" class="mt-6 p-4 bg-gray-100 rounded-lg text-gray-800 italic">
                        Click the button above for an AI-generated tip!
                    </div>
                    <div id="loadingIndicator" class="hidden flex justify-center items-center mt-4">
                        <div class="spinner mr-2"></div>
                        Generating tip...
                    </div>
                </div>
            </div>

            <div class="lg:col-span-2 bg-white rounded-lg shadow-lg p-6 md:p-8 text-center">
                <h2 class="text-2xl font-bold text-[#5B5F97] mb-4">Monarch Conservation in Action!</h2>
                <p class="text-gray-700 mb-8 max-w-2xl mx-auto">Watch this video to see monarchs in their natural habitat and learn more about crucial conservation efforts.</p>
                <div class="relative w-full max-w-xl mx-auto rounded-lg shadow-md overflow-hidden" style="padding-bottom: 56.25%;">
                    <video controls class="absolute top-0 left-0 w-full h-full object-cover">
                        <source src="Monarch_Butterfly_Conservation_Video.mp4" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
            </div>

        </main>

        <footer class="text-center mt-12 pt-8 border-t border-gray-300">
            <p class="text-gray-600">Your garden can be part of a continental recovery effort. Plant milkweed. Save the monarchs.</p>
        </footer>

    </div>

    <script>
        function wrapLabel(str, max_width) {
            if (typeof str !== 'string' || str.length <= max_width) {
                return str;
            }
            const words = str.split(' ');
            let lines = [];
            let current_line = '';
            words.forEach(word => {
                if ((current_line + ' ' + word).length > max_width) {
                    lines.push(current_line);
                    current_line = word;
                } else {
                    current_line = current_line ? current_line + ' ' + word : word;
                }
            });
            lines.push(current_line);
            return lines;
        }

        const tooltipTitleCallback = (tooltipItems) => {
            const item = tooltipItems[0];
            let label = item.chart.data.labels[item.dataIndex];
            if (Array.isArray(label)) {
                return label.join(' ');
            }
            return label;
        };
        
        const populationDeclineCtx = document.getElementById('populationDeclineChart').getContext('2d');
        new Chart(populationDeclineCtx, {
            type: 'doughnut',
            data: {
                labels: ['Population Lost', 'Remaining Population'],
                datasets: [{
                    data: [90, 10],
                    backgroundColor: ['#FFC700', '#DDDDDD'], // Changed to orange here
                    borderColor: ['#FFC700', '#DDDDDD'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: tooltipTitleCallback
                        }
                    }
                }
            }
        });

        const threatsCtx = document.getElementById('threatsChart').getContext('2d');
        const originalThreatLabels = ['Habitat Loss (Milkweed Decline)', 'Pesticides & Herbicides', 'Climate Change', 'Natural Enemies & Disease'];
        const wrappedThreatLabels = originalThreatLabels.map(label => wrapLabel(label, 16));

        new Chart(threatsCtx, {
            type: 'bar',
            data: {
                labels: wrappedThreatLabels,
                datasets: [{
                    label: 'Impact on Monarchs',
                    data: [85, 65, 50, 30],
                    backgroundColor: ['#FF6B6B', '#FFC700', '#5B5F97', '#9295C2'],
                    borderColor: '#ffffff',
                    borderWidth: 2,
                    borderRadius: 5
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true,
                        grid: {
                            display: false,
                            drawBorder: false,
                        },
                        ticks: {
                            display: false
                        }
                    },
                    y: {
                         grid: {
                            display: false,
                            drawBorder: false,
                        },
                        ticks: {
                            color: '#3D3D3D',
                            font: {
                                size: 12,
                                weight: 'bold'
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            title: tooltipTitleCallback
                        }
                    }
                }
            }
        });

        const generateTipBtn = document.getElementById('generateTipBtn');
        const tipOutput = document.getElementById('tipOutput');
        const loadingIndicator = document.getElementById('loadingIndicator');

        generateTipBtn.addEventListener('click', async () => {
            tipOutput.textContent = '';
            loadingIndicator.classList.remove('hidden');
            generateTipBtn.disabled = true;

            let chatHistory = [];
            const prompt = "Provide a unique and actionable tip (1-2 sentences) for successfully growing milkweed or propagating it to help monarch butterflies. Focus on practical advice for a home gardener.";
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            let retries = 0;
            const maxRetries = 5;
            let delay = 1000; // 1 second

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) { // Too Many Requests
                        retries++;
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2; // Exponential backoff
                        continue;
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        tipOutput.textContent = text;
                    } else {
                        tipOutput.textContent = 'Failed to generate tip. Please try again.';
                    }
                    break; // Exit loop on success
                } catch (error) {
                    retries++;
                    if (retries < maxRetries) {
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                    } else {
                        tipOutput.textContent = 'Error generating tip. Please check your connection.';
                    }
                }
            }

            loadingIndicator.classList.add('hidden');
            generateTipBtn.disabled = false;
        });

        const generateFactBtn = document.getElementById('generateFactBtn');
        const factOutput = document.getElementById('factOutput');
        const factLoadingIndicator = document.getElementById('factLoadingIndicator');

        generateFactBtn.addEventListener('click', async () => {
            factOutput.textContent = '';
            factLoadingIndicator.classList.remove('hidden');
            generateFactBtn.disabled = true;

            let chatHistory = [];
            const prompt = "Provide a unique and interesting fact (1-2 sentences) about monarch butterflies.";
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            let retries = 0;
            const maxRetries = 5;
            let delay = 1000; // 1 second

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) { // Too Many Requests
                        retries++;
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2; // Exponential backoff
                        continue;
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        factOutput.textContent = text;
                    } else {
                        factOutput.textContent = 'Failed to generate fact. Please try again.';
                    }
                    break; // Exit loop on success
                } catch (error) {
                    retries++;
                    if (retries < maxRetries) {
                        await new Promise(res => setTimeout(res, delay));
                        delay *= 2;
                    } else {
                        factOutput.textContent = 'Error generating fact. Please check your connection.';
                    }
                }
            }

            factLoadingIndicator.classList.add('hidden');
            generateFactBtn.disabled = false;
        });
    </script>

</body>
</html>

